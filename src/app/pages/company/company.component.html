<div class="flex flex-col align-middle text-white gap-4">
  <section class="text-lg font-semibold mt-2 border border-gray-500 p-1 rounded text-center">
    <p>Cadastro de Empresas</p>
  </section>

  <app-tab [arrayTabsTitle]="company().arrayTab" (selectedTabEmitter)="onChangeCompanyIdx($event)">
    <div class="grid gap-5 md:flex md:items-center md:justify-between md:gap-10 mb-5">
      <app-input-addons
        [optionList]="company().arraySelectFilter"
        [placeholder]="company().placeholderFilter"
        (inputValueEmitter)="company().inputValueFilter = $event"
        (selectValueEmitter)="changeSelectPlaceHolder(company, $event)"></app-input-addons>
      <div class="grid md:flex gap-5">
        <app-table-header-box [tableHeaders]="company().tableHeaderSelected"></app-table-header-box>
        <app-button
          [showIcon]="true"
          [btnIcon]="'add'"
          [label]="'Cadastrar'"
          (click)="onShowModalCompanyForm()"></app-button>
        <app-button [showLabel]="false" [showIcon]="true" [btnType]="'icon-arrow-up'"></app-button>
      </div>
    </div>

    <app-table>
      <tr thead-row>
        @for (header of company().tableHeaderSelected; track $index) {
          @if (header.showHeader) {
            <th class="table-td">
              {{ header.name }}
            </th>
          }
        }
      </tr>
      @for (dataSelected of company().tableDataSelected; track $index) {
        <tr
          tbody-row
          class="hover:bg-gray-700 company-table-row"
          (click)="selectedTableRow($index, 'company-table-row')">
          @if (isTypeValid(dataSelected, 'company')) {
            @if (company().companyTableHeaders[0].showHeader) {
              <td class="table-td">
                {{ dataSelected.idCompany }}
              </td>
            }
            @if (company().companyTableHeaders[1].showHeader) {
              <td class="table-td">
                {{ dataSelected.date | date: 'dd/MM/YYYY' }}
              </td>
            }
            @if (company().companyTableHeaders[2].showHeader) {
              <td class="table-td">{{ dataSelected.nickname }}</td>
            }
            @if (company().companyTableHeaders[3].showHeader) {
              <td class="table-td">{{ dataSelected.name }}</td>
            }
            @if (company().companyTableHeaders[4].showHeader) {
              <td class="table-td">{{ dataSelected.cnpj }}</td>
            }
            @if (company().companyTableHeaders[5].showHeader) {
              <td class="table-td">{{ dataSelected.ie }}</td>
            }
            @if (company().companyTableHeaders[6].showHeader) {
              <td class="table-td">{{ dataSelected.im }}</td>
            }
            @if (company().companyTableHeaders[7].showHeader) {
              <td class="table-td flex justify-center gap-3">
                <app-button
                  (click)="onShowModalEditForm(dataSelected)"
                  [showLabel]="false"
                  [showIcon]="true"
                  [btnType]="'icon-edit'"></app-button>
                <app-button
                  (click)="onShowBaseModalAskToDelete(dataSelected)"
                  [showLabel]="false"
                  [showIcon]="true"
                  [btnType]="'icon-delete'"></app-button>
              </td>
            }
          }
        </tr>
      }
      <div class="flex justify-end">
        <app-button [showLabel]="false" [showIcon]="true" [btnType]="'icon-arrow-up'"></app-button>
      </div>
    </app-table>

    <div class="h-0 opacity-0 transition-all duration-300" id="table-company-item">
      <app-tab
        [arrayTabsTitle]="companyItem().arrayTab"
        (selectedTabEmitter)="onChangeCompanyItemIdx($event, 'company-item-table-row')">
        <div class="grid gap-5 md:flex md:items-center md:justify-between md:gap-10 mb-5">
          <app-input-addons
            [optionList]="companyItem().arraySelectFilter"
            [placeholder]="companyItem().placeholderFilter"
            (inputValueEmitter)="companyItem().inputValueFilter = $event"
            (selectValueEmitter)="changeSelectPlaceHolder(companyItem, $event)"></app-input-addons>
          <div class="grid md:flex gap-5">
            <app-table-header-box
              [tableHeaders]="companyItem().tableHeaderSelected"></app-table-header-box>
            <app-button [showIcon]="true" [btnIcon]="'add'" [label]="'Cadastrar'"></app-button>
          </div>
        </div>

        <app-table>
          <tr thead-row>
            @for (header of companyItem().tableHeaderSelected; track $index) {
              @if (header.showHeader) {
                <th class="table-td">
                  {{ header.name }}
                </th>
              }
            }
          </tr>
          @if (companyItem().tableDataSelected.length == 0) {
            <tr tbody-row class="text-center italic text-white">
              <td [attr.colspan]="companyItem().tableHeaderSelected.length" class="p-2">
                Não existem dados a serem exibidos!
              </td>
            </tr>
          }
          @for (dataSelected of companyItem().tableDataSelected; track $index) {
            <tr
              tbody-row
              class="hover:bg-gray-700 company-item-table-row"
              >
              @if (isTypeValid(dataSelected, 'address')) {
                @if (companyItem().tableHeaderSelected[0].showHeader) {
                  <td class="table-td">
                    {{ dataSelected.idAddress }}
                  </td>
                }
                @if (companyItem().tableHeaderSelected[1].showHeader) {
                  <td class="table-td">
                    {{ dataSelected.type }}
                  </td>
                }
                @if (companyItem().tableHeaderSelected[2].showHeader) {
                  <td class="table-td">{{ dataSelected.address }}</td>
                }
                @if (companyItem().tableHeaderSelected[3].showHeader) {
                  <td class="table-td">{{ dataSelected.number }}</td>
                }
                @if (companyItem().tableHeaderSelected[4].showHeader) {
                  <td class="table-td">{{ dataSelected.complement }}</td>
                }
                @if (companyItem().tableHeaderSelected[4].showHeader) {
                  <td class="table-td">{{ dataSelected.district }}</td>
                }
                @if (companyItem().tableHeaderSelected[4].showHeader) {
                  <td class="table-td">{{ dataSelected.city }}</td>
                }
                @if (companyItem().tableHeaderSelected[4].showHeader) {
                  <td class="table-td">{{ dataSelected.state }}</td>
                }
                @if (companyItem().tableHeaderSelected[5].showHeader) {
                  <td class="table-td flex justify-center gap-3">
                    <app-button
                      (click)="onShowModalEditForm(dataSelected)"
                      [showLabel]="false"
                      [showIcon]="true"
                      [btnType]="'icon-edit'"></app-button>
                    <app-button
                      (click)="onShowModalAskToDeleteCompanyItem()"
                      [showLabel]="false"
                      [showIcon]="true"
                      [btnType]="'icon-delete'"></app-button>
                  </td>
                }
              }
              @if (isTypeValid(dataSelected, 'employee')) {
                @if (companyItem().tableHeaderSelected[0].showHeader) {
                  <td class="table-td">
                    {{ dataSelected.idEmployee }}
                  </td>
                }
                @if (companyItem().tableHeaderSelected[1].showHeader) {
                  <td class="table-td">
                    {{ dataSelected.name }}
                  </td>
                }
                @if (companyItem().tableHeaderSelected[2].showHeader) {
                  <td class="table-td">{{ dataSelected.cpf }}</td>
                }
                @if (companyItem().tableHeaderSelected[3].showHeader) {
                  <td class="table-td">{{ dataSelected.department }}</td>
                }
                @if (companyItem().tableHeaderSelected[4].showHeader) {
                  <td class="table-td">{{ dataSelected.position }}</td>
                }
                @if (companyItem().tableHeaderSelected[4].showHeader) {
                  <td class="table-td">{{ dataSelected.email }}</td>
                }
                @if (companyItem().tableHeaderSelected[4].showHeader) {
                  <td class="table-td">{{ dataSelected.deskphone }}</td>
                }
                @if (companyItem().tableHeaderSelected[4].showHeader) {
                  <td class="table-td">{{ dataSelected.cellphone }}</td>
                }
                @if (companyItem().tableHeaderSelected[5].showHeader) {
                  <td class="table-td flex justify-center gap-3">
                    <app-button
                      [showLabel]="false"
                      [showIcon]="true"
                      [btnType]="'icon-edit'"></app-button>
                    <app-button
                      [showLabel]="false"
                      [showIcon]="true"
                      [btnType]="'icon-delete'"></app-button>
                  </td>
                }
              }
            </tr>
          }
        </app-table>
      </app-tab>
    </div>
  </app-tab>
</div>

<app-modal-base
  [showModal]="modalFormCompany().isActive"
  [isModalForm]="true"
  [title]="
    modalFormCompany().isEditForm ? 'Alterar dados da empresa' : 'Cadastro de nova empresa'
  "
  (emitCloseModal)="onCloseModalForm()">
  <div class="body-block">
    <div class="flex flex-col gap-2">
      @if (modalFormCompany().isEditForm) {
        <div class="flex flex-col gap-1">
          <label class="font-semibold text-sm" for="">Id</label>
          <app-input-standard
            [propsInput]="modalCompanyInfo().idCompany"
            [isClearInputForm]="modalFormCompany().isInputClear"
            [isDisabled]="true"
            [showRightIcon]="false"
            (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'idCompany', $event)"
            [inputClass]="'text-black h-9'"></app-input-standard>
        </div>
      }
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Nickname</label>
        <app-input-standard
          [propsInput]="modalCompanyInfo().nickname"
          [isClearInputForm]="modalFormCompany().isInputClear"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'nickname', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Nome</label>
        <app-input-standard
          [propsInput]="modalCompanyInfo().name"
          [isClearInputForm]="modalFormCompany().isInputClear"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'name', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">CNPJ</label>
        <app-input-standard
          [propsInput]="modalCompanyInfo().cnpj"
          [isClearInputForm]="modalFormCompany().isInputClear"
          #inputModal
          [maskType]="'cnpj'"
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'cnpj', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Inscrição Estadual</label>
        <app-input-standard
          [propsInput]="modalCompanyInfo().ie"
          [isClearInputForm]="modalFormCompany().isInputClear"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'ie', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Inscrição Municipal</label>
        <app-input-standard
          [propsInput]="modalCompanyInfo().im"
          [isClearInputForm]="modalFormCompany().isInputClear"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'im', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
    </div>
  </div>
  <div class="grid footer-block md:flex md:justify-center gap-5 mt-6 w-full">
    <app-button [btnType]="'cancel'" (click)="onCloseModalForm()"></app-button>
    @if (!modalFormCompany().isEditForm) {
      <app-button
        [btnType]="'clear'"
        (click)="modalFormCompany().isInputClear = true"></app-button>
    }
    <app-button
      [btnType]="'forward'"
      (click)="onShowModalCheck(company().tableItemSelected)"></app-button>
  </div>
</app-modal-base>

<app-modal-base
  [showModal]="modalFormAddress().isActive"
  [isModalForm]="true"
  [title]="
    modalFormCompany().isEditForm ? 'Alterar dados de endereço' : 'Cadastro de novo endereço'
  "
  (emitCloseModal)="onCloseModalForm()">
  <div class="body-block">
    <div class="flex flex-col gap-2">
      @if (modalFormAddress().isEditForm) {
        <div class="flex flex-col gap-1">
          <label class="font-semibold text-sm" for="">Id</label>
          <app-input-standard
            [propsInput]="modalAddressInfo().idAddress"
            [isClearInputForm]="modalFormAddress().isInputClear"
            [isDisabled]="true"
            [showRightIcon]="false"
            (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'nickname', $event)"
            [inputClass]="'text-black h-9'"></app-input-standard>
        </div>
      }
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Tipo</label>
        <app-input-standard
          [propsInput]="modalAddressInfo().type"
          [isClearInputForm]="modalFormAddress().isInputClear"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'type', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Endereço</label>
        <app-input-standard
          [propsInput]="modalAddressInfo().address"
          [isClearInputForm]="modalFormAddress().isInputClear"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'address', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Número</label>
        <app-input-standard
          [propsInput]="modalAddressInfo().number"
          [isClearInputForm]="modalFormAddress().isInputClear"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'number', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Complemento</label>
        <app-input-standard
          [propsInput]="modalAddressInfo().complement"
          [isClearInputForm]="modalFormAddress().isInputClear"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'complement', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Bairro</label>
        <app-input-standard
          [propsInput]="modalAddressInfo().district"
          [isClearInputForm]="modalFormAddress().isInputClear"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'district', $event)"
          [inputClass]="'text-black h-9'"></app-input-standard>
      </div>
      <div class="flex flex-col gap-1">
        <div class="flex flex-col gap-1">
          <label class="font-semibold text-sm" for="">Cidade</label>
          <app-input-standard
            [propsInput]="modalAddressInfo().city"
            [isClearInputForm]="modalFormAddress().isInputClear"
            #inputModal
            [showRightIcon]="false"
            (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'city', $event)"
            [inputClass]="'text-black h-9'"></app-input-standard>
        </div>
      </div>
      <label class="font-semibold text-sm" for="">UF</label>
      <app-input-standard
        [propsInput]="modalAddressInfo().state"
        [isClearInputForm]="modalFormAddress().isInputClear"
        #inputModal
        [showRightIcon]="false"
        (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'state', $event)"
        [inputClass]="'text-black h-9'"></app-input-standard>
    </div>
  </div>
  <div class="grid footer-block md:flex md:justify-center gap-5 mt-6 w-full">
    <app-button [btnType]="'cancel'" (click)="onCloseModalForm()"></app-button>
    @if (!modalFormAddress().isEditForm) {
      <app-button
        [btnType]="'clear'"
        (click)="modalFormAddress().isInputClear = true"></app-button>
    }
    <app-button
      [btnType]="'forward'"
      (click)="onShowModalCheck(companyItem().tableItemSelected)"></app-button>
  </div>
</app-modal-base>

<app-modal-base
  [showModal]="modalCheckInfo().isActive"
  [showHeader]="true"
  [title]="'Confirmação dos dados'"
  [isModalForm]="true"
  (emitCloseModal)="modalCheckInfo().isActive = false">
  <div class="body-block text-sm text-center">
    @if (modalFormCompany().isEditForm) {
      <div class="grid grid-cols-[1fr_3fr] border-t border-gray-500">
        <p class="border-r border-l p-2">Id:</p>
        <p class="border-r p-2 font-bold">{{ modalCompanyInfo().idCompany }}</p>
      </div>
    }
    <div class="grid grid-cols-[1fr_3fr] border-t border-gray-500">
      <p class="border-r border-l p-2">Apelido:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().nickname }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t border-gray-500">
      <p class="border-r border-l p-2">Nome:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().name }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t last:border-b border-gray-500">
      <p class="border-r border-l p-2">CNPJ:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().cnpj }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t last:border-b border-gray-500">
      <p class="border-r border-l p-2">Inscrição Estadual:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().ie }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t last:border-b border-gray-500">
      <p class="border-r border-l p-2">Inscrição Municipal:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().im }}</p>
    </div>
  </div>
  <div class="footer-block flex justify-center items-center gap-5 mt-5">
    <app-button [btnType]="'cancel'" (click)="modalCheckInfo().isActive = false"></app-button>
    @if (modalFormCompany().isEditForm) {
      <app-button [btnType]="'success-edit'" (click)="updateCompany()"></app-button>
    } @else {
      <app-button [btnType]="'success-save'" (click)="addNewCompany()"></app-button>
    }
  </div>
</app-modal-base>

<app-modal-base
  [showModal]="modalCheckInfo().isActive"
  [showHeader]="true"
  [title]="'Confirmação dos dados'"
  [isModalForm]="true"
  (emitCloseModal)="modalCheckInfo().isActive = false">
  <div class="body-block text-sm text-center">
    @if (modalFormCompany().isEditForm) {
      <div class="grid grid-cols-[1fr_3fr] border-t border-gray-500">
        <p class="border-r border-l p-2">Id:</p>
        <p class="border-r p-2 font-bold">{{ modalCompanyInfo().idCompany }}</p>
      </div>
    }
    <div class="grid grid-cols-[1fr_3fr] border-t border-gray-500">
      <p class="border-r border-l p-2">Apelido:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().nickname }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t border-gray-500">
      <p class="border-r border-l p-2">Nome:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().name }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t last:border-b border-gray-500">
      <p class="border-r border-l p-2">CNPJ:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().cnpj }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t last:border-b border-gray-500">
      <p class="border-r border-l p-2">Inscrição Estadual:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().ie }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t last:border-b border-gray-500">
      <p class="border-r border-l p-2">Inscrição Municipal:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().im }}</p>
    </div>
  </div>
  <div class="footer-block flex justify-center items-center gap-5 mt-5">
    <app-button [btnType]="'cancel'" (click)="modalCheckInfo().isActive = false"></app-button>
    @if (modalFormCompany().isEditForm) {
      <app-button [btnType]="'success-edit'" (click)="updateCompany()"></app-button>
    } @else {
      <app-button [btnType]="'success-save'" (click)="addNewCompany()"></app-button>
    }
  </div>
</app-modal-base>

<app-modal-ask
  [showModal]="modalAskInfo().isActive"
  [description]="modalInfo().description"
  [type]="modalInfo().type"
  (closeEmitter)="modalAskInfo().isActive = false"
  (actionOkEmitter)="deleteCompany()"></app-modal-ask>
<app-modal-info
  [showModal]="modalInfo().isActive"
  [description]="modalInfo().description"
  [type]="modalInfo().type"
  (closeModalEmitter)="onCloseModalInfo()"></app-modal-info>
<app-loading [showLoading]="showLoading()"></app-loading>
