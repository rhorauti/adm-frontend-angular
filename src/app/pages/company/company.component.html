<div class="flex flex-col align-middle text-white gap-4 overflow-auto">
  <section class="text-lg font-semibold mt-2 border border-gray-500 p-1 rounded text-center">
    <p>Cadastro de Empresas</p>
  </section>

  <app-tab [arrayTabsTitle]="company().arrayTab" (selectedTabEmitter)="setCompanyIdx($event)">
    <div class="grid gap-5 md:flex md:items-center md:justify-between md:gap-10 mb-5">
      <app-input-addons
        [optionList]="company().arraySelectFilter"
        [placeholder]="company().placeholderFilter"
        (inputValueEmitter)="company().inputValueFilter = $event"
        (selectValueEmitter)="changeSelectPlaceHolder(company, $event)"></app-input-addons>
      <div class="grid md:flex gap-5">
        <app-table-header-box [tableHeaders]="company().tableHeaderSelected"></app-table-header-box>
        <app-button
          [showIcon]="true"
          [btnIcon]="'add'"
          [label]="'Cadastrar'"
          (click)="onShowBaseModalForm()"></app-button>
        @if (company().isTableExpanded) {
          <app-button
            [isDisabled]="company().tableDataSelected.length == 0"
            [showLabel]="false"
            [showIcon]="true"
            [btnType]="'icon-arrow-up'"></app-button>
        } @else {
          <app-button
            [isDisabled]="company().tableDataSelected.length == 0"
            [showLabel]="false"
            [showIcon]="true"
            [btnType]="'icon-arrow-down'"></app-button>
        }
      </div>
    </div>

    <app-table>
      <tr thead-row>
        @for (header of company().tableHeaderSelected; track $index) {
          @if (header.showHeader) {
            <th class="table-td">
              {{ header.name }}
            </th>
          }
        }
      </tr>
      @for (dataSelected of company().tableDataSelected; track $index) {
        <tr tbody-row class="hover:bg-gray-700">
          @if (isBaseTypeValid(dataSelected, 'company')) {
            @if (company().companyTableHeaders[0].showHeader) {
              <td class="table-td">
                {{ dataSelected.idCompany }}
              </td>
            }
            @if (company().companyTableHeaders[1].showHeader) {
              <td class="table-td">
                {{ dataSelected.date | date: 'dd/MM/YYYY' }}
              </td>
            }
            @if (company().companyTableHeaders[2].showHeader) {
              <td class="table-td">{{ dataSelected.nickname }}</td>
            }
            @if (company().companyTableHeaders[3].showHeader) {
              <td class="table-td">{{ dataSelected.name }}</td>
            }
            @if (company().companyTableHeaders[4].showHeader) {
              <td class="table-td">{{ dataSelected.cnpj }}</td>
            }
            @if (company().companyTableHeaders[5].showHeader) {
              <td class="table-td">{{ dataSelected.ie }}</td>
            }
            @if (company().companyTableHeaders[6].showHeader) {
              <td class="table-td">{{ dataSelected.im }}</td>
            }
            @if (company().companyTableHeaders[7].showHeader) {
              <td class="table-td flex justify-center gap-3">
                <app-button
                  (click)="onShowModalEditFormCompany(dataSelected)"
                  [showLabel]="false"
                  [showIcon]="true"
                  [btnType]="'icon-edit'"></app-button>
                <app-button
                  (click)="showBaseModalAskToDeleteCompany(dataSelected)"
                  [showLabel]="false"
                  [showIcon]="true"
                  [btnType]="'icon-delete'"></app-button>
              </td>
            }
          }
        </tr>
      }
    </app-table>

    <app-tab
      [arrayTabsTitle]="companyItem().arrayTab"
      [divClass]="'mt-5'"
      (selectedTabEmitter)="companyItem().tabIndex = $event">
      <div class="grid gap-5 md:flex md:items-center md:justify-between md:gap-10 mb-5">
        <app-input-addons
          [optionList]="companyItem().arraySelectFilter"
          [placeholder]="companyItem().placeholderFilter"
          (inputValueEmitter)="companyItem().inputValueFilter = $event"
          (selectValueEmitter)="changeSelectPlaceHolder(companyItem, $event)"></app-input-addons>
        <div class="grid md:flex gap-5">
          <app-table-header-box (click)="companyItem().isHeaderBoxActive"></app-table-header-box>
          <app-button [showIcon]="true" [btnIcon]="'add'" [label]="'Cadastrar'"></app-button>
        </div>
      </div>

      <app-table>
        <tr thead-row>
          @for (header of companyItem().tableHeaderSelected; track $index) {
            @if (header.showHeader) {
              <th class="table-td">
                {{ header.name }}
              </th>
            }
          }
        </tr>
        @for (dataSelected of companyItem().tableDataSelected; track $index) {
          <tr tbody-row class="hover:bg-gray-700">
            @if (isBaseTypeValid(dataSelected, 'address')) {
              @if (companyItem().tableHeaderSelected[0].showHeader) {
                <td class="table-td">
                  {{ dataSelected.idAddress }}
                </td>
              }
              @if (companyItem().tableHeaderSelected[1].showHeader) {
                <td class="table-td">
                  {{ dataSelected.type }}
                </td>
              }
              @if (companyItem().tableHeaderSelected[2].showHeader) {
                <td class="table-td">{{ dataSelected.adress }}</td>
              }
              @if (companyItem().tableHeaderSelected[3].showHeader) {
                <td class="table-td">{{ dataSelected.number }}</td>
              }
              @if (companyItem().tableHeaderSelected[4].showHeader) {
                <td class="table-td">{{ dataSelected.complement }}</td>
              }
              @if (companyItem().tableHeaderSelected[4].showHeader) {
                <td class="table-td">{{ dataSelected.district }}</td>
              }
              @if (companyItem().tableHeaderSelected[4].showHeader) {
                <td class="table-td">{{ dataSelected.city }}</td>
              }
              @if (companyItem().tableHeaderSelected[4].showHeader) {
                <td class="table-td">{{ dataSelected.state }}</td>
              }
              @if (companyItem().tableHeaderSelected[5].showHeader) {
                <td class="table-td flex justify-center gap-3">
                  <app-button
                    (click)="onShowModalEditFormCompany(dataSelected)"
                    [showLabel]="false"
                    [showIcon]="true"
                    [btnType]="'icon-edit'"></app-button>
                  <app-button
                    (click)="showModalAskToDeleteCompanyItem()"
                    [showLabel]="false"
                    [showIcon]="true"
                    [btnType]="'icon-delete'"></app-button>
                </td>
              }
            }
          </tr>
        }
      </app-table>
    </app-tab>
  </app-tab>
</div>

<app-modal-base
  [showModal]="isModalFormActive()"
  [isModalForm]="true"
  [title]="isEditForm() ? 'Alterar dados da empresa' : 'Cadastro de nova empresa'"
  (emitCloseModal)="onCloseModalForm()">
  <div class="body-block">
    <div class="flex flex-col gap-2">
      @if (isEditForm()) {
        <div class="flex flex-col gap-1">
          <label class="font-semibold text-sm" for="">Id</label>
          <app-input-form
            [propsInput]="modalCompanyInfo().idCompany"
            [isClearInputForm]="isInputFormClear()"
            [isDisabled]="true"
            [showRightIcon]="false"
            (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'idCompany', $event)"
            [inputClass]="'text-black h-9'"></app-input-form>
        </div>
      }
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Nickname</label>
        <app-input-form
          [propsInput]="modalCompanyInfo().nickname"
          [isClearInputForm]="isInputFormClear()"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'nickname', $event)"
          [inputClass]="'text-black h-9'"></app-input-form>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Nome</label>
        <app-input-form
          [propsInput]="modalCompanyInfo().name"
          [isClearInputForm]="isInputFormClear()"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'name', $event)"
          [inputClass]="'text-black h-9'"></app-input-form>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">CNPJ</label>
        <app-input-form
          [propsInput]="modalCompanyInfo().cnpj"
          [isClearInputForm]="isInputFormClear()"
          #inputModal
          [maskType]="'cnpj'"
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'cnpj', $event)"
          [inputClass]="'text-black h-9'"></app-input-form>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Inscrição Estadual</label>
        <app-input-form
          [propsInput]="modalCompanyInfo().ie"
          [isClearInputForm]="isInputFormClear()"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'ie', $event)"
          [inputClass]="'text-black h-9'"></app-input-form>
      </div>
      <div class="flex flex-col gap-1">
        <label class="font-semibold text-sm" for="">Inscrição Municipal</label>
        <app-input-form
          [propsInput]="modalCompanyInfo().im"
          [isClearInputForm]="isInputFormClear()"
          #inputModal
          [showRightIcon]="false"
          (emitInputValue)="setCompanyProperty(company().tableItemSelected, 'im', $event)"
          [inputClass]="'text-black h-9'"></app-input-form>
      </div>
    </div>
  </div>
  <div class="grid footer-block md:flex md:justify-center gap-5 mt-6 w-full">
    <app-button [btnType]="'cancel'" (click)="onCloseModalForm()"></app-button>
    @if (!isEditForm()) {
      <app-button [btnType]="'clear'" (click)="isInputFormClear.set(true)"></app-button>
    }
    <app-button
      [btnType]="'forward'"
      (click)="onShowModalCheckCompany(company().tableItemSelected)"></app-button>
  </div>
</app-modal-base>

<app-modal-base
  [showModal]="isModalCheckActive()"
  [showHeader]="true"
  [title]="'Confirmação dos dados'"
  [isModalForm]="true"
  (emitCloseModal)="isModalCheckActive.set(false)">
  <div class="body-block text-sm text-center">
    @if (isEditForm()) {
      <div class="grid grid-cols-[1fr_3fr] border-t border-gray-500">
        <p class="border-r border-l p-2">Id:</p>
        <p class="border-r p-2 font-bold">{{ modalCompanyInfo().idCompany }}</p>
      </div>
    }
    <div class="grid grid-cols-[1fr_3fr] border-t border-gray-500">
      <p class="border-r border-l p-2">Apelido:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().nickname }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t border-gray-500">
      <p class="border-r border-l p-2">Nome:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().name }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t last:border-b border-gray-500">
      <p class="border-r border-l p-2">CNPJ:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().cnpj }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t last:border-b border-gray-500">
      <p class="border-r border-l p-2">Inscrição Estadual:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().ie }}</p>
    </div>
    <div class="grid grid-cols-[1fr_3fr] border-t last:border-b border-gray-500">
      <p class="border-r border-l p-2">Inscrição Municipal:</p>
      <p class="border-r p-2 font-bold">{{ modalCompanyInfo().im }}</p>
    </div>
  </div>
  <div class="footer-block flex justify-center items-center gap-5 mt-5">
    <app-button [btnType]="'cancel'" (click)="isModalCheckActive.set(false)"></app-button>
    @if (isEditForm()) {
      <app-button [btnType]="'success-edit'" (click)="updateCompany()"></app-button>
    } @else {
      <app-button [btnType]="'success-save'" (click)="addNewCompany()"></app-button>
    }
  </div>
</app-modal-base>

<app-modal-ask
  [showModal]="isModalAskActive()"
  [description]="modalData().description"
  [type]="modalData().type"
  (closeEmitter)="isModalAskActive.set(false)"
  (actionOkEmitter)="deleteCompany()"></app-modal-ask>
<app-modal-info
  [showModal]="isModalInfoActive()"
  [description]="modalData().description"
  [type]="modalData().type"
  (closeModalEmitter)="onCloseModalInfoCompany()"></app-modal-info>
<app-loading [showLoading]="showLoading()"></app-loading>
